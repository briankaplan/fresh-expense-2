# Environment Setup Guide

This guide explains how to set up environment variables for the Expense Tracking application.

## Required Environment Variables

### Development Environment

- `DEV_JWT_SECRET`: Secret key for JWT token generation in development
- `DEV_MONGODB_URI`: MongoDB connection string for development

### Test Environment

- `TEST_JWT_SECRET`: Secret key for JWT token generation in testing
- `TEST_MONGODB_URI`: MongoDB connection string for testing

### Production Environment

- `PROD_JWT_SECRET`: Secret key for JWT token generation in production
- `PROD_MONGODB_URI`: MongoDB connection string for production
- `PROD_API_URL`: API URL for the frontend to connect to

## Setting Up Environment Variables

### Local Development

1. Copy `.env.example` to `.env` in the `apps/backend/config` directory
2. Replace the placeholder values with your actual values
3. For development, you can use the default values in `development.env`

### Generating Secrets

1. Run the secrets generation script:

   ```bash
   ./scripts/generate-secrets.sh
   ```

2. The script will output secure values for all required secrets
3. Replace the placeholder MongoDB URI and API URL with your actual values

### Setting Up MongoDB Atlas (Production)

1. Create a MongoDB Atlas account at [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Create a new cluster:
   - Choose your preferred cloud provider and region
   - Select the M0 FREE tier for development or appropriate tier for production
   - Click "Create Cluster"
3. Set up database access:
   - Go to "Database Access" in the left sidebar
   - Click "Add New Database User"
   - Choose "Password" authentication
   - Create a strong password
   - Select appropriate privileges (at least readWrite)
4. Set up network access:
   - Go to "Network Access" in the left sidebar
   - Click "Add IP Address"
   - Add your IP address or allow access from anywhere (0.0.0.0/0) for development
5. Get your connection string:
   - Click "Connect" on your cluster
   - Choose "Connect your application"
   - Copy the connection string
   - Replace `<password>` with your database user password
   - Replace `<username>` with your database username
   - Replace `cluster.mongodb.net` with your actual cluster name

### GitHub Actions

1. Go to your repository settings
2. Navigate to "Secrets and variables" > "Actions"
3. Add the following secrets using the values generated by the script:
   - `DEV_JWT_SECRET`
   - `DEV_MONGODB_URI`
   - `TEST_JWT_SECRET`
   - `TEST_MONGODB_URI`
   - `PROD_JWT_SECRET`
   - `PROD_MONGODB_URI` (use your MongoDB Atlas connection string)
   - `PROD_API_URL` (use your production domain)

### Docker

The Docker workflow automatically uses the environment variables from GitHub Actions secrets.
Make sure all required secrets are set in your repository settings.

## Security Best Practices

1. Never commit `.env` files to version control
2. Use strong, unique secrets for each environment
3. Rotate secrets regularly
4. Use environment-specific databases
5. Keep production secrets separate from development and test secrets
6. Use the secrets generation script to create secure values
7. Store production secrets in a secure vault or password manager
8. Use MongoDB Atlas IP whitelisting for production
9. Enable MongoDB Atlas encryption at rest
10. Use strong passwords for database users
11. Regularly rotate database credentials

## Troubleshooting

If you encounter issues with environment variables:

1. Check that all required secrets are set in GitHub Actions
2. Verify the environment file format
3. Ensure the correct environment is being used
4. Check the workflow logs for any substitution errors
5. Run the secrets generation script to verify the format of your secrets
6. Verify MongoDB Atlas connection:
   - Check if your IP is whitelisted
   - Verify database user credentials
   - Ensure the cluster is running
   - Check network connectivity
7. Test API URL accessibility:
   - Verify DNS resolution
   - Check SSL certificate
   - Test endpoint availability
